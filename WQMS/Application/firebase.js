let admin=require("firebase-admin"),serviceAccount=require("./serviceAccountKey.json");admin.initializeApp({credential:admin.credential.cert(serviceAccount),databaseURL:"<your_database_url>"});let db=admin.database(),ref_log=db.ref("log"),ref_current=db.ref("current_value"),ref_alerts=db.ref("alerts"),dataRange={moisture:{max:100,min:0,required:{max:100,min:95}},turbidity:{max:1e3,min:0,required:{max:5,min:0}},ph:{max:14,min:0,required:{max:8.5,min:6.5}}};function map(e,r,n,t,a){return(e-r)/(n-r)*(a-t)+t}function constrain(e,r,n){return e<=r?r:e>=n?n:e}function convertToPercentage(e,r,n){e=map(e,dataRange.moisture.required.min,dataRange.moisture.required.max,0,1),r=map(r,dataRange.turbidity.required.min,dataRange.turbidity.required.max,0,1),n=map(n,dataRange.ph.required.min,dataRange.ph.required.max,0,1);let t=Math.abs(map((e+r+n)/3,0,1,-1,1));return{abs:t,percentage:Math.round(100*constrain(map(t,0,1,1,0),0,1))}}module.exports.db=db,module.exports.log=ref_log,module.exports.current=ref_current,module.exports.alerts=ref_alerts,module.exports.getDate=function(e){let r=new Date;return yy=r.getFullYear(),mm=r.getMonth()+1,dd=r.getDate(),mm=mm<10?"0"+mm:mm,dd=dd<10?"0"+dd:dd,yy+e+mm+e+dd},module.exports.getTime=function(e){let r=new Date;return H=r.getHours(),M=r.getMinutes(),S=r.getSeconds(),H=H<10?"0"+H:H,M=M<10?"0"+M:M,S=S<10?"0"+S:S,H+e+M+e+S},module.exports.searchKeysByPeriod=function(e,r){let n=(new Date).getMonth(),t=(new Date).getFullYear();return"TM"==e?r=r.map(e=>e.replace(/_/g,"/")).filter(function(e){if(new Date(e).getMonth()===n&&new Date(e).getFullYear()===t)return e}).map(e=>e.split("/").join("_")):"LM"==e?r=r.map(e=>e.replace(/_/g,"/")).filter(function(e){if(n-1<0&&(t-=1),new Date(e).getMonth()===n-1&&new Date(e).getFullYear()===t)return e}).map(e=>e.split("/").join("_")):"LM3"==e?r=r.map(e=>e.replace(/_/g,"/")).filter(function(e){let r=t;for(i=n;i>n-3;i--)if(i<0&&(r=t-1),new Date(e).getMonth()===i&&new Date(e).getFullYear()===r)return e}).map(e=>e.split("/").join("_")):"LM6"==e?r=r.map(e=>e.replace(/_/g,"/")).filter(function(e){let r=t;for(i=n;i>n-6;i--)if(i<0&&(r=t-1),new Date(e).getMonth()===i&&new Date(e).getFullYear()===r)return e}).map(e=>e.split("/").join("_")):"LM12"==e&&(r=r.map(e=>e.replace(/_/g,"/")).filter(function(e){let r=t;for(i=n;i>n-12;i--)if(i<0&&(r=t-1),new Date(e).getMonth()===i&&new Date(e).getFullYear()===r)return e}).map(e=>e.split("/").join("_"))),r},module.exports.Dashboard=function(e){let r={};for(L in e){let n=convertToPercentage(e[L].sensor_1,e[L].sensor_2,e[L].sensor_3);n.abs<.25?r[L]={bg:"success",msg:"Good",percentage:n.percentage}:n.abs>=.25&&n.abs<.5?r[L]={bg:"info",msg:"Moderate",percentage:n.percentage}:n.abs>=.5&&n.abs<.75?r[L]={bg:"warning",msg:"Bad",percentage:n.percentage}:r[L]={bg:"danger",msg:"very Bad",percentage:n.percentage}}return r},module.exports.UpdateDashboard=function(e){let r=convertToPercentage(e.sensor_1,e.sensor_2,e.sensor_3);return r.abs<.25?current_values={bg:"success",msg:"Good",percentage:r.percentage}:r.abs>=.25&&r.abs<.5?current_values={bg:"info",msg:"Moderate",percentage:r.percentage}:r.abs>=.5&&r.abs<.75?current_values={bg:"warning",msg:"Bad",percentage:r.percentage}:current_values={bg:"danger",msg:"very Bad",percentage:r.percentage},current_values},module.exports.BasicInfo=function(e){let r=convertToPercentage(e.sensor_1,e.sensor_2,e.sensor_3),n="";return n=r.abs<.25?"Good":r.abs>=.25&&r.abs<.5?"Moderate":r.abs>=.5&&r.abs<.75?"Bad":"Very Bad",{s1:{value:e.sensor_1,msg:e.sensor_1<=dataRange.moisture.required.max&&e.sensor_1>=dataRange.moisture.required.min?"Permissible":"Impermissible"},s2:{value:e.sensor_2,msg:e.sensor_2<=dataRange.turbidity.required.max&&e.sensor_2>=dataRange.turbidity.required.min?"Permissible":"Impermissible"},s3:{value:e.sensor_3,msg:e.sensor_3<=dataRange.ph.required.max&&e.sensor_3>=dataRange.ph.required.min?"Permissible":"Impermissible"},qi:{value:r.percentage,msg:n},date:e.date,time:e.time}},module.exports.BasicInfoToday=function(e){return{moisture:{max:e.max_sensor_1,min:e.min_sensor_1},turbidity:{max:e.max_sensor_2,min:e.min_sensor_2},ph:{max:e.max_sensor_3,min:e.min_sensor_3}}},module.exports.PreviousInfo=function(e){let r={},n={},t={};for(key in e){let a={max:e[key].max_sensor_1,min:e[key].min_sensor_1},s={max:e[key].max_sensor_2,min:e[key].min_sensor_2},i={max:e[key].max_sensor_3,min:e[key].min_sensor_3};r[key]=a,n[key]=s,t[key]=i}return{moisture:r,turbidity:n,ph:t}},module.exports.CurrentTable=function(e){let r={};for(key in e){let n=convertToPercentage(e[key].sensor_1,e[key].sensor_2,e[key].sensor_3);r[key]={s1:e[key].sensor_1,s2:e[key].sensor_2,s3:e[key].sensor_3,qi:n.percentage}}return r};