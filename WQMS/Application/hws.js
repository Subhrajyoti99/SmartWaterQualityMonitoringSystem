// Hardware Simulator
var Firebase=require("./firebase");let emulator=!1,interval=1e4,PID=[],dataRange={moisture:{max:100,min:0,required:{max:100,min:95}},turbidity:{max:1e3,min:0,required:{max:5,min:0}},ph:{max:14,min:0,required:{max:8.5,min:6.5}}},random=(e,a,s=0)=>(e+Math.random()*(a-e)).toFixed(s),process=(e,a)=>setInterval(e,a),sensorDataGen=()=>{let e={s1:0,s2:0,s3:0};return Math.random()>.01?e.s1=random(dataRange.moisture.required.min,dataRange.moisture.required.max):e.s1=random(dataRange.moisture.min,dataRange.moisture.max),Math.random()>.01?e.s2=random(dataRange.turbidity.required.min,dataRange.turbidity.required.max):e.s2=random(dataRange.turbidity.min,dataRange.turbidity.max),Math.random()>.01?e.s3=random(dataRange.ph.required.min,dataRange.ph.required.max,1):e.s3=random(dataRange.ph.min,dataRange.ph.max,1),e},updateCurrent=(e,a)=>{Firebase.db.ref(e).set({date:Firebase.getDate("_"),sensor_1:parseInt(a.s1),sensor_2:parseInt(a.s2),sensor_3:parseFloat(a.s3),time:Firebase.getTime(":")})},updateMaxMin=(e,a)=>{let s=Firebase.getDate("_");Firebase.db.ref(`${e}/${s}/f`).once("value").then(function(r){null==r.toJSON()?Firebase.db.ref(`${e}/${s}`).set({f:!0,max_sensor_1:parseInt(a.s1),max_sensor_2:parseInt(a.s2),max_sensor_3:parseFloat(a.s3),min_sensor_1:parseInt(a.s1),min_sensor_2:parseInt(a.s2),min_sensor_3:parseFloat(a.s3)}):Firebase.db.ref(`${e}/${s}`).once("value").then(function(r){let n=r.toJSON(),t={f:!0,max_sensor_1:n.max_sensor_1>parseInt(a.s1)?n.max_sensor_1:parseInt(a.s1),max_sensor_2:n.max_sensor_2>parseInt(a.s2)?n.max_sensor_2:parseInt(a.s2),max_sensor_3:n.max_sensor_3>parseFloat(a.s3)?n.max_sensor_3:parseFloat(a.s3),min_sensor_1:n.min_sensor_1<parseInt(a.s1)?n.min_sensor_1:parseInt(a.s1),min_sensor_2:n.min_sensor_2<parseInt(a.s2)?n.min_sensor_2:parseInt(a.s2),min_sensor_3:n.min_sensor_3<parseFloat(a.s3)?n.min_sensor_3:parseFloat(a.s3)};Firebase.db.ref(`${e}/${s}`).set(t)})})};module.exports.emulator=emulator,module.exports.interval=interval,module.exports.run=function(e="Unknown",a=1e4){let s=process(()=>{let a=sensorDataGen();updateCurrent(`current_value/${e}`,a),updateMaxMin(`log/${e}`,a)},a);console.log(`Started- ${s}`),PID.push(s)},module.exports.stop=function(){PID.forEach(e=>{clearInterval(e)}),PID=[]};